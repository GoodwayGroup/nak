module.exports=function(e,r){r(null,{execute:function(e,r){function n(e,r){for(var n=[];e.length>0&&r.length>0;)e[0].toLowerCase()>r[0].toLowerCase()?n.push(r.shift()):n.push(e.shift());return n=n.concat(e,r)}function i(){console.error("Usage: [options] 'PATTERN' ['REPLACEMENT'] 'PATH' \n"),console.error("Options:");for(var e=0,r=f[0];f.length>e;e++,r=f[e]){var n=(r[0]?"-"+r[0]+(r[1]?"|":""):"   ")+(r[1]?"--"+r[1]:""),i=n+(-1!=r[2].indexOf(":")?" Â«valueÂ»":"");i+=20>i.length?Array(20-i.length).join(" "):"",console.error("	"+(-1!=r[2].indexOf("!")?"*":" ")+(-1!=r[2].indexOf("+")?"+":" ")+i+"	"+r[3])}process.exit(0)}function t(e){var r=dirExclusions=[];q.pathToNakignore&&(r=s.readFileSync(q.pathToNakignore,"utf-8"));try{dirExclusions=s.readFileSync(e+"/.nakignore","utf-8")}catch(n){}var i=r+"\n"+dirExclusions+"\n"+(void 0!==q.ignore?q.ignore:"");i.length&&(q.exclusions=i.split(/\r?\n/).filter(function(e){return!!e&&/^[^#]/.test(e)}),q.exclusionsLength=q.exclusions.length)}function o(e,r){var n="g";q.literal&&(e=l.escapeRegExp(e)),q.ignoreCase&&(n+="i"),q.wordRegexp&&(e="\\b(?:"+e+")\\b"),q.query=RegExp(e,n),r&&(q.replacement=r)}var s=require("fs");isbinaryfile=function(e,r){if(void 0===r){var n=e;e=s.readFileSync(n),r=s.statSync(n).size}var i=0,t=r>1024?1024:r;if(0==r)return!1;if(r>=3&&239==e[0]&&187==e[1]&&191==e[2])return 0;for(var o=0;t>o;o++){if(o>32&&100*i/t>10)return!0;if("0"==e[o])return!0;if((7>e[o]||e[o]>14)&&(32>e[o]||e[o]>127)){if(e[o]>191&&224>e[o]&&t>o+1){if(o++,192>e[o])continue}else if(e[o]>223&&239>e[o]&&t>o+2&&(o++,192>e[o]&&192>e[o+1])){o++;continue}i++}}return 100*i/t>10?!0:!1};var a=module.exports=function(e){var r=e.length;if(2>r)return e;var i=Math.ceil(r/2);return n(a(e.slice(0,i)),a(e.slice(i)))},l={};module.exports=l;var c=(l.makeRules=function(e,r){for(var n=[],i=0,t=function(e){return RegExp(c(e).replace(/\\\*/g,".?"))};r>i;)n.push(t(e[i++]));return n},l.isIgnored=function(e,r,n,i){if(!i&&(/^\.\w/.test(n)||/\/\.\w/.test(n)))return!0;for(var t=0;r>t;)if(e[t++].test(n))return!0;return!1},l.escapeRegExp=function(e){return e.replace(/([\/'*+?|()\[\]{}.^$])/g,"\\$1")});l.makeWildcardRegExp=function(e,r){return e?(e=e.replace(/\s/g,""),e=c(e),e=e.replace(/\\\*/g,".*"),e=e.replace(/\\\?/g,"."),r?(e=e.replace(/,/g,"|"),e=RegExp("(?:"+e+")")):e):""};var p={};module.exports=p;var f=[["l","list","","list files encountered"],["H","hidden","","search hidden files and directories (default off)"],["c","color","","adds color to results  (default off)"],["a","pathToNakignore",":","path to an additional nakignore file"],["m","maxdepth",":","the maximum depth of the search"],["q","literal","","do not parse PATTERN as a regular expression; match it literally"],["w","wordRegexp","","only match whole words"],["i","ignoreCase","","match case insensitively"],["G","fileSearch",":","comma-separated list of wildcard files to only search on"],["d","ignore",":","comma-separated list of wildcard files to additionally ignore"],["p","piped","","indicates filenames are being piped in (like, from ag or find)"]];p.parseArgs=function(e){2!=process.argv.length||e?void 0!==e&&(process.argv=e):i();var r=[],n={};n.args=[];for(var t=0,o=process.argv[0],s=process.argv.length;s>t;t++,o=process.argv[t])"-"==o.charAt(0)?"-"==o.charAt(1)?r.push("--",o.slice(2)):r=r.concat(o.split("").join("-").split("").slice(1)):r.push(o);for(;type=r.shift();)if("-"==type||"--"==type){var a=r.shift();("help"==a||"h"==a)&&i();for(var l=null,t=0,o=f[0];f.length>t;t++,o=f[t])if(o[type.length-1]==a){l=o;break}var c=!0;-1==l[2].indexOf(":")||(c=r.shift())||(console.error("Option '"+type+a+"' expects a parameter!"),i());var p=l[1]||l[0];-1!=l[2].indexOf("+")?(n[p]=n[p]instanceof Array?n[p]:[],n[p].push(c)):n[p]=c,"function"==typeof l[4]&&l[4](c),l[2]=l[2].replace("!","")}else n.args.push(type);return void 0===e&&n.args.splice(0,2),n};var u={};module.exports=u;var s=require("fs"),d=(require("path"),require("string_decoder").StringDecoder),g=new d("utf8"),l=l,h=isbinaryfile,a=a,m={},v={},x=0,y=0,k="/",w=function(e){y+=e,1>e&&!E&&(E=1,process.nextTick(function(){E=0,0>=y&&!x&&(x=1,finalizer())}))},E=0;u.walkdir=function(e,r,n,i){if(r.maxdepth=r.maxdepth||1/0,r.exclusions=r.exclusionsLength>0?l.makeRules(r.exclusions,r.exclusionsLength):"",r.hidden=r.hidden||!1,finalizer=function(){if(r.list){for(var e=a(Object.keys(m)),t="",o="",l=0,c=e.length;c>l;l++)o=m[e[l]],t+=a(o).join("\n")+"\n";n(t)}else{for(var p=a(Object.keys(v)),f=0,u=p.length;u>f;f++){var d=p[f],x=s.readFileSync(d);if(!h(x,v[d].stat.size)){var y=g.write(x);if(r.query.lastIndex=0,r.query.test(y)){var k=y.match(r.query).length,w=k,E="";if(r.replacement){var q=y.replace(r.query,r.replacement);s.writeFile(d,q,"utf8")}for(var y=y.split("\n"),R=0,b=y.length;w&&b>R;R++)r.query.lastIndex=0,r.query.test(y[R])&&(E+="	"+(R+1)+": "+(r.replacement?y[R].replace(r.query,r.replacement):y[R])+"\n",w--);n(d,E,k,p)}}}i()}},statter=function(e,n,i){w(1);var t=function(t){w(-1),t.isFile()?r.list?m[e].push(n):(v[n]={},v[n].stat=t):t.isDirectory()&&readdir(n,i)};t(s.lstatSync(n))},readdir=function(e,n){if(!(n>=r.maxdepth)){var i=function(i){if(w(-1),!i)return"Permission error (or other failure) on: "+i;var t=i.length,o=0;for(m[e]=[];t>o;){var s=i[o++],a=e+k+s;r.filesInclude.test(s)&&!l.isIgnored(r.exclusions,r.exclusionsLength,a,r.hidden)&&statter(e,a,(n||0)+1)}};l.isIgnored(r.exclusions,r.exclusionsLength,e,r.hidden)||(w(1),s.readdir(e,function(e,r){e&&(console.error(e),process.exit(1)),i(r)}))}},r.piped)for(var t=e.split("\n"),o=0,c=t.length;c>o;o++)t[o].length&&statter(t[o]);else readdir(e,1)};var q=p.parseArgs(e),s=require("fs"),R=require("path"),b=u.walkdir,l=l;if(q.piped)process.stdin.resume(),process.stdin.setEncoding("utf8"),q.args.length>1?o(q.args.shift(),q.args.shift()):o(q.args.shift()),process.stdin.on("data",function(e){q.piped=!0,b(e,q,function(e,n){q.color?(r(null,A,e),n=n.replace(F,T),r(null,j,n)):(r(null,e),r(null,n))})});else{var S=R.resolve(q.args.pop()),C=null,F=null,A="",T="",j="";if(1==q.args.length?F=q.args.pop():2==q.args.length&&(C=q.args.pop(),F=q.args.pop()),q.color&&(A="\n[36m%s[0m",T="[37;43m[0;90m",j="[90m%s"),q.filesInclude=q.fileSearch?l.makeWildcardRegExp(q.fileSearch,!0):{test:function(){return!0}},t(S),F){o(F,C);var O=0,P=0;b(S,q,function(e,n,i){q.color?(r(null,A,e+":"),n=n.replace(q.query,T),r(null,j,n)):(r(null,e+":"),r(null,n)),O+=i,P++},function(){r(null,"Found "+O+(1==O?" match":" matches")+" in "+P+(1==P?" file ":" files "))})}else q.list&&b(S,q,function(e){r(null,e)})}}})};