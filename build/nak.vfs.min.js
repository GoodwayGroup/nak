module.exports=function(e,r){r(null,{execute:function(e,r){function n(e,r){for(var n=[];e.length>0&&r.length>0;)e[0]>r[0]?n.push(r.shift()):n.push(e.shift());return n=n.concat(e,r)}function i(){console.error("Usage: [options] 'PATTERN' ['REPLACEMENT'] 'PATH' \n"),console.error("Options:");for(var e=0,r=f[0];f.length>e;e++,r=f[e]){var n=(r[0]?"-"+r[0]+(r[1]?"|":""):"   ")+(r[1]?"--"+r[1]:""),i=n+(-1!=r[2].indexOf(":")?" Â«valueÂ»":"");i+=20>i.length?Array(20-i.length).join(" "):"",console.error("	"+(-1!=r[2].indexOf("!")?"*":" ")+(-1!=r[2].indexOf("+")?"+":" ")+i+"	"+r[3])}process.exit(0)}function t(e){var r=dirExclusions=[];E.pathToNakignore&&(r=s.readFileSync(E.pathToNakignore,"utf-8"));try{dirExclusions=s.readFileSync(e+"/.nakignore","utf-8")}catch(n){}var i=r+"\n"+dirExclusions+"\n"+(void 0!==E.ignore?E.ignore:"");i.length&&(E.exclusions=i.split(/\r?\n/).filter(function(e){return!!e&&/^[^#]/.test(e)}),E.exclusionsLength=E.exclusions.length)}function o(e,r){var n="g";E.literal&&(e=l.escapeRegExp(e)),E.ignoreCase&&(n+="i"),E.wordRegexp&&(e="\\b(?:"+e+")\\b"),E.query=RegExp(e,n),r&&(E.replacement=r)}var s=require("fs");isbinaryfile=function(e,r){if(void 0===r){var n=e;e=s.readFileSync(n),r=s.statSync(n).size}var i=0,t=r>1024?1024:r;if(0==r)return!1;if(r>=3&&239==e[0]&&187==e[1]&&191==e[2])return 0;for(var o=0;t>o;o++){if(o>32&&100*i/t>10)return!0;if("0"==e[o])return!0;if((7>e[o]||e[o]>14)&&(32>e[o]||e[o]>127)){if(e[o]>191&&224>e[o]&&t>o+1){if(o++,192>e[o])continue}else if(e[o]>223&&239>e[o]&&t>o+2&&(o++,192>e[o]&&192>e[o+1])){o++;continue}i++}}return 100*i/t>10?!0:!1};var a=module.exports=function(e){var r=e.length;if(2>r)return e;var i=Math.ceil(r/2);return n(a(e.slice(0,i)),a(e.slice(i)))},l={};module.exports=l;var c=(l.makeRules=function(e,r){for(var n=[],i=0,t=function(e){return RegExp(c(e).replace(/\\\*/g,".?"))};r>i;)n.push(t(e[i++]));return n},l.isIgnored=function(e,r,n,i){if(!i&&(/^\.\w/.test(n)||/\/\.\w/.test(n)))return!0;for(var t=0;r>t;)if(e[t++].test(n))return!0;return!1},l.escapeRegExp=function(e){return e.replace(/([\/'*+?|()\[\]{}.^$])/g,"\\$1")});l.makeWildcardRegExp=function(e,r){return e?(e=e.replace(/\s/g,""),e=c(e),e=e.replace(/\\\*/g,".*"),e=e.replace(/\\\?/g,"."),r?(e=e.replace(/,/g,"|"),e=RegExp("(?:"+e+")")):e):""};var p={};module.exports=p;var f=[["l","list","","list files encountered"],["H","hidden","","search hidden files and directories (default off)"],["c","color","","adds color to results  (default off)"],["a","pathToNakignore",":","path to an additional nakignore file"],["m","maxdepth",":","the maximum depth of the search"],["q","literal","","do not parse PATTERN as a regular expression; match it literally"],["w","wordRegexp","","only match whole words"],["i","ignoreCase","","match case insensitively"],["G","fileSearch",":","comma-separated list of wildcard files to only search on"],["d","ignore",":","comma-separated list of wildcard files to additionally ignore"],["p","piped","","indicates filenames are being piped in (like, from ag or find)"]];p.parseArgs=function(e){2!=process.argv.length||e?void 0!==e&&(process.argv=e):i();var r=[],n={};n.args=[];for(var t=0,o=process.argv[0],s=process.argv.length;s>t;t++,o=process.argv[t])"-"==o.charAt(0)?"-"==o.charAt(1)?r.push("--",o.slice(2)):r=r.concat(o.split("").join("-").split("").slice(1)):r.push(o);for(;type=r.shift();)if("-"==type||"--"==type){var a=r.shift();("help"==a||"h"==a)&&i();for(var l=null,t=0,o=f[0];f.length>t;t++,o=f[t])if(o[type.length-1]==a){l=o;break}var c=!0;-1==l[2].indexOf(":")||(c=r.shift())||(console.error("Option '"+type+a+"' expects a parameter!"),i());var p=l[1]||l[0];-1!=l[2].indexOf("+")?(n[p]=n[p]instanceof Array?n[p]:[],n[p].push(c)):n[p]=c,"function"==typeof l[4]&&l[4](c),l[2]=l[2].replace("!","")}else n.args.push(type);return void 0===e&&n.args.splice(0,2),n};var u={};module.exports=u;var s=require("fs"),d=(require("path"),require("string_decoder").StringDecoder),g=new d("utf8"),l=l,h=isbinaryfile,a=a,m=[],v={},x=0,y=0,k=function(e){y+=e,1>e&&!q&&(q=1,process.nextTick(function(){q=0,0>=y&&!x&&(x=1,finalizer())}))},q=0;u.walkdir=function(e,r,n,i){if(r.maxdepth=r.maxdepth||1/0,r.exclusions=r.exclusionsLength>0?l.makeRules(r.exclusions,r.exclusionsLength):"",r.hidden=r.hidden||!1,finalizer=function(){if(r.list)n(a(m).join("\n"));else{for(var e=a(Object.keys(v)),t=0,o=e.length;o>t;t++){var l=e[t],c=s.readFileSync(l);if(!h(c,v[l].stat.size)){var p=g.write(c);if(r.query.lastIndex=0,r.query.test(p)){var f=p.match(r.query).length,u=f,d="";if(r.replacement){var x=p.replace(r.query,r.replacement);s.writeFile(l,x,"utf8")}for(var p=p.split("\n"),y=0,k=p.length;u&&k>y;y++)r.query.lastIndex=0,r.query.test(p[y])&&(d+="	"+(y+1)+": "+(r.replacement?p[y].replace(r.query,r.replacement):p[y])+"\n",u--);n(l,d,f,e)}}}i()}},statter=function(e,n){k(1);var i=function(i){k(-1),i.isFile()?r.list?m.push(e):(v[e]={},v[e].stat=i):i.isDirectory()&&readdir(e,n)};i(s.lstatSync(e))},readdir=function(e,n){if(!(n>=r.maxdepth)){var i=function(i){if(k(-1),!i)return"Permission error (or other failure) on: "+i;for(var t=i.length,o=0;t>o;){var s=i[o++],a=e+"/"+s;r.filesInclude.test(s)&&!l.isIgnored(r.exclusions,r.exclusionsLength,a,r.hidden)&&statter(a,(n||0)+1)}};l.isIgnored(r.exclusions,r.exclusionsLength,e,r.hidden)||(k(1),s.readdir(e,function(e,r){e&&(console.error(e),process.exit(1)),i(r)}))}},r.piped)for(var t=e.split("\n"),o=0,c=t.length;c>o;o++)t[o].length&&statter(t[o]);else readdir(e,1)};var E=p.parseArgs(e),s=require("fs"),w=require("path"),R=u.walkdir,l=l;if(E.piped)process.stdin.resume(),process.stdin.setEncoding("utf8"),E.args.length>1?o(E.args.shift(),E.args.shift()):o(E.args.shift()),process.stdin.on("data",function(e){E.piped=!0,R(e,E,function(e,n){E.color?(r(null,A,e),n=n.replace(F,T),r(null,C,n)):(r(null,e),r(null,n))})});else{var b=w.resolve(E.args.pop()),S=null,F=null,A="",T="",C="";if(1==E.args.length?F=E.args.pop():2==E.args.length&&(S=E.args.pop(),F=E.args.pop()),E.color&&(A="\n[36m%s[0m",T="[37;43m[0;90m",C="[90m%s"),E.filesInclude=E.fileSearch?l.makeWildcardRegExp(E.fileSearch,!0):{test:function(){return!0}},t(b),F){o(F,S);var j=0,O=0;R(b,E,function(e,n,i){E.color?(r(null,A,e+":"),n=n.replace(E.query,T),r(null,C,n)):(r(null,e+":"),r(null,n)),j+=i,O++},function(){r(null,"Found "+j+(1==j?" match":" matches")+" in "+O+(1==O?" file ":" files "))})}else E.list&&R(b,E,function(e){r(null,e)})}}})};