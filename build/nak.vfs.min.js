module.exports=function(e,r){r(null,{execute:function(e,r){function n(e,r){for(var n=[];e.length>0&&r.length>0;)e[0].toLowerCase()>r[0].toLowerCase()?n.push(r.shift()):n.push(e.shift());return n=n.concat(e,r)}function o(){console.error("Usage: [options] 'PATTERN' ['REPLACEMENT'] 'PATH' \n"),console.error("Options:");for(var e=0,r=f[0];f.length>e;e++,r=f[e]){var n=(r[0]?"-"+r[0]+(r[1]?"|":""):"   ")+(r[1]?"--"+r[1]:""),o=n+(-1!=r[2].indexOf(":")?" Â«valueÂ»":"");o+=20>o.length?Array(20-o.length).join(" "):"",console.error("	"+(-1!=r[2].indexOf("!")?"*":" ")+(-1!=r[2].indexOf("+")?"+":" ")+o+"	"+r[3])}process.exit(0)}function t(e){var r=dirExclusions=[];q.pathToNakignore&&(r=s.readFileSync(q.pathToNakignore,"utf-8"));try{dirExclusions=s.readFileSync(e+"/.nakignore","utf-8")}catch(n){}var o=r+"\n"+dirExclusions+"\n"+(void 0!==q.ignore?q.ignore:"");o.length&&(q.exclusions=o.split(/\r?\n/).filter(function(e){return!!e&&/^[^#]/.test(e)}),q.exclusionsLength=q.exclusions.length)}function i(e,r){var n="g";q.literal&&(e=l.escapeRegExp(e)),q.ignoreCase&&(n+="i"),q.wordRegexp&&(e="\\b(?:"+e+")\\b"),q.query=RegExp(e,n),r&&(q.replacement=r)}var s=require("fs");isbinaryfile=function(e,r){if(void 0===r){var n=e;e=s.readFileSync(n),r=s.statSync(n).size}var o=0,t=r>1024?1024:r;if(0==r)return!1;if(r>=3&&239==e[0]&&187==e[1]&&191==e[2])return 0;for(var i=0;t>i;i++){if(i>32&&100*o/t>10)return!0;if("0"==e[i])return!0;if((7>e[i]||e[i]>14)&&(32>e[i]||e[i]>127)){if(e[i]>191&&224>e[i]&&t>i+1){if(i++,192>e[i])continue}else if(e[i]>223&&239>e[i]&&t>i+2&&(i++,192>e[i]&&192>e[i+1])){i++;continue}o++}}return 100*o/t>10?!0:!1};var a=module.exports=function(e){var r=e.length;if(2>r)return e;var o=Math.ceil(r/2);return n(a(e.slice(0,o)),a(e.slice(o)))},l={};module.exports=l;var c=(l.makeRules=function(e,r){for(var n=[],o=0,t=function(e){return RegExp(c(e).replace(/\\\*/g,".?"))};r>o;)n.push(t(e[o++]));return n},l.isIgnored=function(e,r,n,o){if(!o&&(/^\.\w/.test(n)||/\/\.\w/.test(n)))return!0;for(var t=0;r>t;)if(e[t++].test(n))return!0;return!1},l.escapeRegExp=function(e){return e.replace(/([\/'*+?|()\[\]{}.^$])/g,"\\$1")});l.makeWildcardRegExp=function(e,r){return e?(e=e.replace(/\s/g,""),e=c(e),e=e.replace(/\\\*/g,".*"),e=e.replace(/\\\?/g,"."),r?(e=e.replace(/,/g,"|"),e=RegExp("(?:"+e+")")):e):""};var p={};module.exports=p;var f=[["l","list","","list files encountered"],["H","hidden","","search hidden files and directories (default off)"],["c","color","","adds color to results  (default off)"],["a","pathToNakignore",":","path to an additional nakignore file"],["m","maxdepth",":","the maximum depth of the search"],["q","literal","","do not parse PATTERN as a regular expression; match it literally"],["w","wordRegexp","","only match whole words"],["i","ignoreCase","","match case insensitively"],["G","fileSearch",":","comma-separated list of wildcard files to only search on"],["d","ignore",":","comma-separated list of wildcard files to additionally ignore"],["p","piped","","indicates filenames are being piped in (like, from ag or find)"],["j","json","","returns results as JSON; these are NOT sorted. it's also a little slower."]];p.parseArgs=function(e){2!=process.argv.length||e?void 0!==e&&(process.argv=e):o();var r=[],n={};n.args=[];for(var t=0,i=process.argv[0],s=process.argv.length;s>t;t++,i=process.argv[t])"-"==i.charAt(0)?"-"==i.charAt(1)?r.push("--",i.slice(2)):r=r.concat(i.split("").join("-").split("").slice(1)):r.push(i);for(;type=r.shift();)if("-"==type||"--"==type){var a=r.shift();("help"==a||"h"==a)&&o();for(var l=null,t=0,i=f[0];f.length>t;t++,i=f[t])if(i[type.length-1]==a){l=i;break}var c=!0;-1==l[2].indexOf(":")||(c=r.shift())||(console.error("Option '"+type+a+"' expects a parameter!"),o());var p=l[1]||l[0];-1!=l[2].indexOf("+")?(n[p]=n[p]instanceof Array?n[p]:[],n[p].push(c)):n[p]=c,"function"==typeof l[4]&&l[4](c),l[2]=l[2].replace("!","")}else n.args.push(type);return void 0===e&&n.args.splice(0,2),n};var u={};module.exports=u;var s=require("fs"),d=(require("path"),require("string_decoder").StringDecoder),g=new d("utf8"),l=l,h=isbinaryfile,a=a,m={},v={},x=0,y=0,k="/",w=function(e){y+=e,1>e&&!E&&(E=1,process.nextTick(function(){E=0,0>=y&&!x&&(x=1,finalizer())}))},E=0;u.walkdir=function(e,n,o,t){if(n.maxdepth=n.maxdepth||1/0,n.exclusions=n.exclusionsLength>0?l.makeRules(n.exclusions,n.exclusionsLength):"",n.hidden=n.hidden||!1,finalizer=function(){if(n.list)if(n.json)o(m);else{for(var e=a(Object.keys(m)),i="",l="",c=0,p=e.length;p>c;c++)l=m[e[c]],i+=a(l).join("\n")+"\n";o(i)}else{for(var f=a(Object.keys(v)),u=0,d=f.length;d>u;u++){var x=f[u],y=s.readFileSync(x);if(!h(y,v[x].stat.size)){if(n.json){var k={};k[x]={}}var w=g.write(y);if(n.query.lastIndex=0,n.query.test(w)){var E=w.match(n.query).length,q=E,R="";if(n.replacement){var j=w.replace(n.query,n.replacement);s.writeFile(x,j,"utf8")}for(var w=w.split("\n"),S=0,b=w.length;q&&b>S;S++)if(n.query.lastIndex=0,n.query.test(w[S])){var C=n.replacement?w[S].replace(n.query,n.replacement):w[S];n.json?k[x][S+1]=C:R+="	"+(S+1)+": "+C+"\n",q--}n.json?r(null,k):o(x,R,E,f)}}}t()}},statter=function(e,r,o){w(1);var t=function(t){w(-1),t.isFile()?n.list?m[e].push(r):(v[r]={},v[r].stat=t):t.isDirectory()&&readdir(r,o)};t(s.lstatSync(r))},readdir=function(e,r){if(!(r>=n.maxdepth)){var o=function(o){if(w(-1),!o)return"Permission error (or other failure) on: "+o;var t=o.length,i=0;for(m[e]=[];t>i;){var s=o[i++],a=e+k+s;n.filesInclude.test(s)&&!l.isIgnored(n.exclusions,n.exclusionsLength,a,n.hidden)&&statter(e,a,(r||0)+1)}};l.isIgnored(n.exclusions,n.exclusionsLength,e,n.hidden)||(w(1),s.readdir(e,function(e,r){e&&(console.error(e),process.exit(1)),o(r)}))}},n.piped)for(var i=e.split("\n"),c=0,p=i.length;p>c;c++)i[c].length&&statter(i[c]);else readdir(e,1)};var q=p.parseArgs(e),s=require("fs"),R=require("path"),j=u.walkdir,l=l;if(q.piped)process.stdin.resume(),process.stdin.setEncoding("utf8"),q.args.length>1?i(q.args.shift(),q.args.shift()):i(q.args.shift()),process.stdin.on("data",function(e){q.piped=!0,j(e,q,function(e,n){q.color?(r(null,O,e),n=n.replace(C,T),r(null,F,n)):(r(null,e),r(null,n))})});else{var S=R.resolve(q.args.pop()),b=null,C=null,O="",T="",F="";if(1==q.args.length?C=q.args.pop():2==q.args.length&&(b=q.args.pop(),C=q.args.pop()),q.color&&(O="\n[36m%s[0m",T="[37;43m[0;90m",F="[90m%s"),q.filesInclude=q.fileSearch?l.makeWildcardRegExp(q.fileSearch,!0):{test:function(){return!0}},t(S),C){i(C,b);var A=0,P=0;j(S,q,function(e,n,o){q.color?(r(null,O,e+":"),n=n.replace(q.query,T),r(null,F,n)):(r(null,e+":"),r(null,n)),A+=o,P++},function(){q.json||r(null,"Found "+A+(1==A?" match":" matches")+" in "+P+(1==P?" file ":" files "))})}else q.list&&j(S,q,function(e){r(null,e)})}}})};